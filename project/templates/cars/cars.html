{%  extends 'base.html' %}

{% block content %}
<script>
    function showConfirmRegisterationModal(plate_id) {
        var modal = document.getElementById('confirmReservationModal');
        modal.setAttribute('data-plate-id', plate_id);
        var bootstrapModal = new bootstrap.Modal(modal, {});
        bootstrapModal.show();
    }

    function confirmReservation() {
        var modal = document.getElementById('confirmReservationModal');
        document.getElementById('plate_id').setAttribute('value', modal.getAttribute('data-plate-id'));
        document.getElementById('reserveForm').submit();
    }
</script>
<h1>Cars</h1>

<div>
    <form class="form-inline md-form mr-auto mb-4">
        <div class="card bg-dark text-white">
            <input class="form-control mr-sm-2" type="search" placeholder="Search Plate ID" aria-label="Search"
                name="search_plate_id">
        </div>
        <div class="card bg-dark text-white">
            <input class="form-control mr-sm-2" type="search" placeholder="Search Model" aria-label="Search"
                name="search_model">
        </div>
        <div class="card bg-dark text-white">
            <input class="form-control mr-sm-2" type="search" placeholder="Search Color" aria-label="Search"
                name="search_color">
        </div>
        <div class="card bg-dark text-white">
            <input class="form-control mr-sm-2" type="search" placeholder="Search Year" aria-label="Search"
                name="search_year">
        </div>

        <select id="car_status" name="car_status" class="form-select" aria-label="Default select example">
            <option value="">Any</option>
            {% for car_status in car_statuses %}
                <option value="{{ car_status.id }}">{{ car_status.name }}</option>
            {% endfor %}
        </select>

        <div class="card bg-dark text-white">
            <input class="form-control mr-sm-2" type="search" placeholder="Search Office Name" aria-label="Search"
                name="search_office_name">
        </div>
        <div class="card bg-dark text-white">
            <input class="form-control mr-sm-2" type="search" placeholder="Search Office Location" aria-label="Search"
                name="search_office_location">
        </div>

        <button class="btn btn-primary blue-gradient  btn-rounded btn-sm my-2" type="submit">Search</button>
    </form>
</div>

<div>
    {% if request.user.is_superuser %}
    <a class="btn btn-primary" href="{% url 'add_car' %}">Add Car +</a>
    {% endif %}
</div>

<div class="card bg-dark text-white">
    <table class="table table-dark table-striped">
        <tr>
            <th>Plate</th>
            <th>Model</th>
            <th>Color</th>
            <th>Year</th>
            <th>Office Name</th>
            <th>Office Location</th>
            <th></th>
            {% if request.user.is_superuser %}
                <th></th>
            {% endif %}
        </tr>

        {% for car in cars %}
            <tr>
                <td><a href="{% url 'car_details' plate_id=car.plate_id %}">{{ car.plate_id }}</a></td>
                <td>{{ car.model }}</td>
                <td>{{ car.color }}</td>
                <td>{{ car.year }}</td>
                <td>{{ car.belong_office.office_name }}</td>
                <td>{{ car.belong_office.office_location }}</td>

                <td><button class="btn btn-primary" onclick="showConfirmRegisterationModal({{ car.plate_id }})">Reserve</button></td>
                {% if request.user.is_superuser %}
                    <td><a class="btn btn-primary" href="{% url 'edit_car' plate_id=car.plate_id %}">Edit</a></td>
                {% endif %}
            </tr>
        {% endfor %}
    </table>
</div>


<div class="modal fade" id="confirmReservationModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content bg-dark">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Confirm reservation</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">Are you sure you want to reserve this car?</div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="confirmReservation()">Confirm reservation</button>
            </div>
        </div>
    </div>
</div>

<form id="reserveForm" method="POST" action="{% url 'reserve_car' %}">
    {% csrf_token %}
    <input type="hidden" name="plate_id" id="plate_id" />
</form>

{% endblock content %}
